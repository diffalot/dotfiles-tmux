# tmux plugin manager
#   - install <C-B> <C-I>
#   - update  <C-B> <C-U>
#
##  fix for missing terminfos  #################################################
#
# # test for italic output
#
# ## Levels of a working italicized terminal
#
# - `italics` should be printed in italics in your terminal when you enter
#     `echo -e "\e[3m italics \e[23m"` [1] or
#     `echo -e "\\x1b[3m italics \\x1b[23m"`
# - Programs like `htop` and `tig` should be running in full color, not black
#   and white
# - When you open vim you should see a nice colorscheme in 256 colors
#   todo: Find the command that prints out how many colors vim is using
# - You should be able to repeat all of those tests in `tmux`
# - Once all of those are verified, check if you have fonts inside `nvim` inside
#   `tmux`
#
# `tmux` is stealthy--start it up with a named session and you might find a #0
# session hiding out after you exit.  And don't believe that it's completely
# shut down after you `tmux kill-server`; I run a `killall tmux` right after
# that and let me know `killall` ever fails to report `No matching processes`;
# that just means `killall` is gonna be eating well tonight.
#
# if there's an old `tmux` server running from before you changed the configs,B"
# it's got you old settings on it, and you have no idea if what you put on disk
# is a good setup.--
#
# ## How the different terminal emulators fare at different `TERM` settings
#
# Terminal Emulator Behaviour on macOS with TERM and Color Depth Overrides
#
# - TERM set in application's own preferences
#   - Establish a baseline and record what $TERM has been set to in each case
# - TERM set in tmux `terminal-overrides`
#   - Kill any remainig `tmux` processes and restart
#
# 3. `TRUECOLOR` set in `tmux.conf`
# 4. `terminal-overrides` set for color depth in tmux
# 5. color depth overridden in nvim `init.vim`
# 6. excape code overrides set in `init.vim`
#
# Legend of symbols and marks:
# - `tmux` overrides in `.tmux.conf`
#   - `envTC` - Set Truecolor environment with
#               `set-environment -g COLORTERM "truecolor"``
#   - `orTC`  - Force Truecolor on with
#               `set-option -a terminal-overrides ",*:Tc"`
#   - `orRGB` - Force RGB colors with
#               `set-option -a terminal-overrides ",*:RGB"`
#
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Settings                                        | Display | open | foo in | open | italics  |
#|                                                 |         |      |        |      | in vim   |
#|                                                 | __foo__ | vim  | tmux   | htop | in tmux  |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM = none = `xterm-kitty`               |         |      |        |      |          |
#| tmux  TERM = none = `screen`                    | yes     | yes  | no     |      |          |
#| tmux  Overrides = envTC, orTC, orRGB            |         |      |        |      |          |
#| nvim  Overrides = not attempted                 |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM `xterm-256color` => `xterm-256color` |         |      |        |      | yes, but |
#| tmux  TERM `xterm-256color` => `xterm-256color` |         |      |        |      | Home and |
#| tmux  Overrides = envTC, orTC, orRGB            | yes     | yes  | yes    | yes  | End keys |
#| nvim  Overrides = none                          |         |      |        |      | stopped  |
#|                                                                                  | working  |
#| I thought I'd gotten very lucky with this one for a little while. I thinkthere   |          |
#| is something to using these wrong setting when the ones that have been provided  |          |
#| are at just as wrong.  If I can't get any of these other modes closer, I'll      |          |
#| Probably come back to this one for round three... If those keys are reporting    |          |
#| anything it's probably easier to just map them than all of this.
#
#| Another option suggested by this resule is compiling our own terminfo:
#|
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM = `xterm-kitty` = `xterm-kitty`      |         |      |        |      |          |
#| tmux  TERM = `tmux-256color` = `tmux-256color`  | yes     |      | vim    |no    |   no              |
#| tmux  Overrides = orRGB, envTC, orTC            |         |      |        | color  italics       |          |
#| nvim  Overrides = not attempted                 |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM = `xterm-kitty` = `xterm-kitty`      |         |      |        |      |          |
#| tmux  TERM = `tmux-256color` = `tmux-256color`  |         |      |        |      |                   |
#| tmux  Overrides = envTC, orTC,      |         |      |        |                      |          |
#| nvim  Overrides = not attempted                 |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#|                                                 |         |      |        |      |          |
#| Everyone talked about Truecolor a lot and RGB   |         |      |        |
#| very little so, I wanted to see if RGB mattered |                                              |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM = none = `xterm-kitty`               |         |      |        |      |          |
#| tmux  TERM = none = `screen`                    |         |      |        |      |          |
#| tmux  Overrides =                               |         |      |        |      |          |
#| nvim  Overrides = not attempted                 |         |      |        |      |          |
#|                                                 |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM = `screen-256color` = ``             |         |      |        |      |          |
#| tmux  TERM = none = ``                          |         |      |        |      |          |
#| tmux  Overrides = envTC,                        |         |      |        |      |          |
#| nvim  Overrides = not attempted                 |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM `xterm-256color`                     |         |      |        |      |          |
#| tmux  TERM `screen-256color`                    |         |      |        |      |          |
#| nvim  Overrides = [envTC, orRGB, orTC]          |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM `screen-256color`                    |         |      |        |      |          |
#| tmux  TERM       none                           |         |      |        |      |          |
#| nvim  Overrides  none                           |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#| Kitty TERM `tmux-256color`                      |         |      |        |      |          |
#| tmux  TERM       none                           |         |      |        |      |          |
#| nvim  Overrides  none                           |         |      |        |      |          |
#+-------------------------------------------------+---------+------+--------+------+----------+
#
# Testing Configs (these just have to come after the new-session thing, we'll
# back to the real config soon)

#set-option -g default-terminal "tmux-256color"
set-option -g default-terminal "tmux-256color-italic"
#set-option -g default-terminal "screen-256color"
set-option -ga terminal-overrides ",xterm-kitty:RGB"
set-option -ga terminal-overrides ",xterm-kitty:Tc"
set-option -ga terminal-overrides ",xterm-256color:RGB"
set-option -ga terminal-overrides ",xterm-256color:Tc"
set-option -ga terminal-overrides ",*:RGB"
set-option -ga terminal-overrides ",*:Tc"

#set-option -ga terminal-overrides ""*:Ss=\E[%p1%d q:Se=\E[ q""
#
# [1][https://stackoverflow.com/questions/3494435/vimrc-make-comments-italic]
#
#
# I'm gonna keep the following notes around even I've something working right
# in a terminal that I like.  I'm not counting on it staying like this forever.
#
#                                                                           --
#                                                                        Alice
#                                                                   2021-05-20
#
#  Notes from a Previous Rodeo  ###############################################
#
# despite all the blog posts and miscellaneous info I gleaned from the detrius
# of other people's computing configurations, I just don't know what to believe
# anymore.
#
# I don't know why it works this way. Everyone who said it shouldn't work this
# way acknowledged that it did. And they took action in their disbelief and
# compiled terminfo files, reverse engineering technology that has never
# existed, and we now have the closest thing to proof of the non existence of
# these strange devices: Not one of those blog posts was ever right in the end.
#
# All you have to do to get that weird little terminal app on your phone to
# connect to these strange containerized, networked boxes in full truecolor
# glory, is set everything to pretend to operate at 256 colors and claim to be
# a progream called screen. It's true, here's what I did once I had exhausted
# all other possibilities:
#
#     1. I set the terminal was typing into to `xterm-256color`
#
#     2. One I was on the server it claimed i was merely `xterm` so i set the
#        TERM environment variable to `xterm-256color` and my way to join the
#        tmux session.
#
#     3. Once inside the session I bumped myself up frome `screen` to
#        `screen-256color` to match what tmux hat been configured it was:
#        `screen-256color` and everything has been smooth since then.
#
#        (I guess i messed up the first part of this story... jus                                                    --
#                                                                        Alice
#                                                                   2021-05-12
#
#  And now, here is the config!  ##############################################
#
#  fix for neovim in tmux in st terminal  #####################################
#
# set -as terminal-overrides ',st*:Ss@'
#
#  Fix Undercurl  #############################################################

set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0

#  preferences  ###############################################################
#
set -g mouse on                # turn on mouse controls
set -g base-index 1            # start windows numbering at 1
set -g renumber-windows on     # renumber windows when a window is closed
set -g set-titles on           # set terminal title
set -g display-panes-time 800  # slightly longer pane indicators display time
set -g display-time 1000       # slightly longer status messages display time
set -g status-interval 10      # redraw status line every 10 seconds
set -g aggressive-resize       # allow windows attached to two or more clients
set -g pane-base-index 1       # make pane numbering consistent with windows
set -g automatic-rename on     # rename window to reflect current program
#                              # in the same session to have different sizes
#                              # limited by the smallest screen size of the
#                              # clients that are attached to the same window
#
# open new windows and panes with current path
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# spend more time in misc. vi modes
set -g status-keys vi
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

#  default plugins  ###########################################################
#
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-yank'

# Prefix + F for assisted copy/paste
# set -g @plugin 'Morantron/tmux-fingers'

## i3 for tmux
## https://github.com/jabirali/tmux-tilish
set -g @plugin 'jabirali/tmux-tilish'
set -g @tilish-default 'main-horizontal'

# https://github.com/christoomey/vim-tmux-navigator
#set -g @plugin 'christoomey/vim-tmux-navigator'

# https://github.com/sainnhe/tmux-fzf
set -g @plugin 'sainnhe/tmux-fzf'

TMUX_FZF_LAUNCH_KEY="C-Space" # press after Prefix
TMUX_FZF_MENU=\
"Light scheme-tmux day\n"\
"Dark scheme-tmux\n"\
"attach session\n/home/alice/.tmux/plugins/tmux-fzf/scripts/session.sh attach\n"\
"rename window\n/home/alice/.tmux/plugins/tmux-fzf/scripts/window.sh rename\n"
TMUX_FZF_ORDER="pane|window|session|command|keybinding|process"
TMUX_FZF_OPTIONS="-p -w 62% -h 38% -m"

###############################################################################
# the following are managed by the scheme-tmux script in fish/functions #######

# COLOUR (base16)

# default statusbar colors
set-option -g status-style "fg=#9f9da2,bg=default"

# default window title colors
set-window-option -g window-status-style "fg=default,bg=default"

# active window title colors
set-window-option -g window-status-current-style "fg=#dc8a0e,bg=default"

# pane border
set-option -g pane-border-style "fg=#666369"
set-option -g pane-active-border-style "fg=#17ad98"

# message text
set-option -g message-style "fg=#bcbabe,bg=#4a464d"

# pane number display
set-option -g display-panes-active-colour "#17ad98"
set-option -g display-panes-colour "#dc8a0e"

# clock
set-window-option -g clock-mode-colour "#17ad98"

# copy mode highligh
set-window-option -g mode-style "fg=#9f9da2,bg=#666369"

# bell
set-window-option -g window-status-bell-style "bg=#17ad98,fg=#d8137f"

# end script management #######################################################

# status left
set -g status-left-length 120
set -g status-left '#[fg=#17ad98]#{?client_prefix,#[bg=#dc8a0e],} ⁂ #S ❱ #[fg=default]'

set -g status-left-length 40
set -g status-right " #[fg=#17ad98]❰#[fg=default] #[fg=#dc8a0e]#W #[fg=#17ad98]#I:#P ⁂#[fg=default] "

###############################################################################
#  tmux plugin manager run config (must be last command)  #####################
run -b '~/.tmux/plugins/tpm/tpm'

#set-environment COLORTERM "truecolor"
###############################################################################
# todo(Alice): find a cross platform (Linux, macOS) (tmux, vim) shared
# clipboard system<F12><F12><F12>
