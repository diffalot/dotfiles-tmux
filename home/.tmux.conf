# todo(Alice): find a cross platform (Linux, macOS) (tmux, vim) shared clipboard system

# if run as "tmux attach", create a session if one does not already exist
new-session -n $HOST
# tmux plugin manager
# install <C-I>
# update  <C-U>

# default plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-yank'

# save session layouts between sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
# https://github.com/tmux-plugins/tmux-resurrect/blob/master/docs/restoring_pane_contents.md#known-issue
# for vim
set -g @resurrect-strategy-vim 'session'
# for neovim
set -g @resurrect-strategy-nvim 'session'
# vim and neovim restoration require them to have
# https://github.com/tpope/vim-obsession

# fix for iPhone terminal
set -g default-terminal 'xterm-256color'
#set -g default-terminal "tmux-256color"
#set -ga terminal-overrides ",*256col*:Tc"
#set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'

# fix for neovim in tmux in st terminal
#set -as terminal-overrides ',st*:Ss@'

set-environment -g COLORTERM "truecolor"

# fish is the default shell
#set-option -g default-shell /usr/bin/fish
#set-option -g default-command "reattach-to-user-namespace -l fish"
#set-option -g default-shell /usr/local/bin/fish

# neat plugins can work together
set -g @plugin 'kristijanhusak/tmux-simple-git-status'
#set -g status-right "#{simple_git_status}"
set -g @plugin 'tmux-plugins/tmux-cpu'
#set -g status-right '#{cpu_bg_color} CPU: #{cpu_icon} #{cpu_percentage} | %a %h-%d %H:%M '
#set -g @plugin 'Alkindi42/tmux-bitwarden'

# themes take over the appearance for you
#set -g @plugin "arcticicestudio/nord-tmux"

#set -g @plugin 'wfxr/tmux-power'
#set -g @tmux_power_theme 'violet'
#set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
#set -g @tmux_power_prefix_highlight_pos 'LR'

set -g @plugin 'seebi/tmux-colors-solarized'
#set -g @colors-solarized '256'
#set -g @colors-solarized 'dark'
#set -g @colors-solarized 'light'
#set -g @colors-solarized 'base16'

#set -g @plugin 'jimeh/tmux-themepack'
#set -g @themepack 'powerline/default/cyan'
#set -g @themepack 'powerline/double/green'
#set -g @themepack 'powerline/double/red'

# todo(alice): debug this
# the backround color of the right status is controlled by cpu temp
# the text colour is the default green to yellow to red as ram fills
set -g @cpu_low_bg_color "#[bg=default]" # background color when cpu is low
set -g @cpu_medium_bg_color "#[bg=bright,cyan]" # background color when cpu is medium
set -g @cpu_high_bg_color "#[bg=bright,magenta]" # background color when cpu is high
set -g @ram_low_fg_color "#[fg=bright,green]" # background color when cpu is low
set -g @ram_medium_fg_color "#[fg=yellow]" # background color when cpu is medium
set -g @ram_high_fg_color "#[fg=red]" # background color when cpu is high

## these are handy for testing color combinations
#set -g @cpu_medium_thresh "40" # medium percentage threshold
#set -g @cpu_high_thresh "70" # high percentage threshold
#set -g @ram_medium_thresh "30" # medium percentage threshold
#set -g @ram_high_thresh "70" # high percentage threshold
#set -g @ram_medium_thresh "0" # medium percentage threshold
#set -g @ram_high_thresh "70" # high percentage threshold

# customize only the right status
set -g status-right '#{ram_fg_color}#{cpu_bg_color} %Hh #{cpu_percentage} #{ram_percentage} #{simple_git_status}'

# preferences
set -g mouse on               # turn on mouse controls
set -g aggressive-resize      # allow windows attached to two or more clients in the same session to have different sizes limited by the smallest screen size of the clients that are attached to the same window
set -g base-index 1           # start windows numbering at 1
setw -g pane-base-index 1     # make pane numbering consistent with windows
setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed
set -g set-titles on          # set terminal title
set -g display-panes-time 800 # slightly longer pane indicators display time
set -g display-time 1000      # slightly longer status messages display time
set -g status-interval 10     # redraw status line every 10 seconds

# clipboard integration
# <c-v> pastes from system clipboard
#bind-key c-v run "xsel -o | tmux load-buffer - ; tmux paste-buffer"

# open new windows and panes with current path
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# tmux plugin manager run config (must be last command)
run -b '~/.tmux/plugins/tpm/tpm'
